@{
    ViewBag.Title = "GuestDetails";
    Layout = "~/Views/Shared/_cpLayout.cshtml";
}

@Styles.Render("~/Content/datatable_css")
<link href="~/Content/Custom/clientDets.css" rel="stylesheet" />
<link href="~/Content/Fonts/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
<link href="~/Content/Custom/custom-table.css" rel="stylesheet" />
@Scripts.Render("~/bundles/datatable")

@*<script src="~/Scripts/JDatatables11012/js/jquery.dataTables.min.js"></script>
<script src="~/Scripts/JDatatables11012/js/dataTables.jqueryui.min.js"></script>
<script src="~/Scripts/jquery-ui-1.8.24.min.js"></script>
<link href="~/Content/Custom/clientDets.css" rel="stylesheet" />
<link type="text/css" href="~/Content/themes/smoothness/jquery-ui.css" rel="stylesheet" />
<link type="text/css" href="~/Content/JDatatables11012/css/dataTables.jqueryui.min.css" rel="stylesheet" />
<link type="text/css" href="~/Content/JDatatables11012/css/select.jqueryui.min.css" rel="stylesheet" />*@

<div class="col-md-12">
    <div class="titlesbar">
        <div class="col-md-6 caption">
            <i class="fa fa-user font-yellow-crusta" aria-hidden="true"></i><span class="text-uppercase">Guest Details</span>
        </div>
    </div>
</div>
<div class="clearfix"></div>
<div id="GuestResults">
    <div class="row-fluid col-md-12">
        <table id="guestmasView" class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th style="width: 125px;">&nbsp;</th>
                    <th>SrNo.</th>
                    <th>Guest</th>
                    <th>Email Id</th>
                    <th>Company</th>
                    <th>Office No</th>
                    <th>Contact No</th>
                    <th>Created On</th>
                    <th>Last Visited On</th>
                    <th>Login(s)</th>
                    <th>Is Deleted?</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="clearfix"></div>
    <div class="row-fluid col-md-12">
        @Html.Hidden("ActMethod", "GuestDets")
    </div>

    <script language="javascript" type="text/javascript">
        var curgrid = '#guestmasView';
        $(document).ready(function () {
            var sMethod = $("#ActMethod").val(); urlReq = '@Url.Action("serverMethod")';
            var oTable = drawDataTable();
            /*-------------------------------------*/
            function drawDataTable(additionalData) {
                /*SetLoadingProc();*/
                var oTable = $(curgrid).DataTable({
                    oLanguage: { sProcessing: "<img src='../../Content/images/loader.gif'>" },
                    bProcessing: true, serverSide: true, bSort: false, sAjaxSource: urlReq.replace("serverMethod", sMethod),
                    aLengthMenu: [25, 50, 100], iDisplayLength: 25, bLengthChange: true, bDestroy: true, bAutoWidth: false,
                    sEmptyTable: "Loading data from server", searching: false, paging: true, scrollX: true, scrollY: "395px",
                    stateSave: false,
                    fnServerData: function (sSource, aaData, fnCallback) {
                        if (additionalData != undefined) { aaData.push(additionalData[0]); aaData.push(additionalData[1]); }
                        $.ajax({ "dataType": 'json', "type": "POST", "url": sSource, "data": aaData, "success": fnCallback }).complete(function () { /*RemoveLoadingProc();*/ });
                    },
                    fnCreatedRow: function (nRow, aData, iDataIndex) {
                        $(nRow).attr('id', aData[1])
                        $('td:eq(0)', nRow).html('<a class="btn btn-danger btn-action" href="javascript:void(0)" title="Hapus" onclick="removeClient(' + aData[1] + ')"><i class="glyphicon glyphicon-trash"></i></a>');
                    },
                }); return oTable;
            }

            $("#txtLoginNm").autocomplete({
                source: function (request, response) { $.ajax({ url: "@Url.Action("LoginNames", "Account")", type: "POST", dataType: "json", data: { Prefix: request.term }, success: function (data) { response($.map(data, function (item) { return { label: item.Name, value: item.Name }; })) } }) },
                messages: { noResults: "", results: "" }
            });
        });

            function removeClient(rowId) {
                debugger;
                SetLoadingProc();
                if (rowId != '') {
                    var ret = confirm('Are you sure to remove this client profile'); if (ret == false) { RemoveLoadingProc(); return false; }
                    var params = { 'pEmailId': $('#guestmasView tr[id*=' + rowId + ']').find('td:nth-child(4)').html(), 'pCompanyNm': $('#guestmasView tr[id*=' + rowId + ']').find('td:nth-child(5)').html(), 'pStatus': $('#guestmasView tr[id*=' + rowId + ']').find('td:nth-child(11)').html() }
                    $.ajax({
                        url: '@Url.Action("HandleGuest", "Account")', type: 'POST', datatype: 'JSON', data: params,
                        success: function (data) { if (data.isError) { alert(data.msg); RemoveLoadingProc(); return false; } else { alert(data.msg); RemoveLoadingProc(); window.location = data.url; } }, error: function () { alert('Something went wrong..'); RemoveLoadingProc(); }
                    }).complete(function () { RemoveLoadingProc(); });
                } return false;
            }
    </script>
</div>
