@{
    ViewBag.Title = "AppointmentDets";
    Layout = "~/Views/Shared/_cpLayout.cshtml";
}

@{
    var ApptStatus = new SelectList(
        new List<SelectListItem>
        {
            new SelectListItem {Text = "Pending", Value = "P"},
            new SelectListItem {Text = "Fixed", Value = "F"},
            new SelectListItem {Text = "Rejected", Value = "R"},
        }, "Value", "Text");
}

@Styles.Render("~/Content/datatable_css")
<link href="~/Content/Custom/processes.css" rel="stylesheet" />
@Scripts.Render("~/bundles/datatable")
<link href="~/Content/Fonts/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
<link href="~/Content/Custom/custom-table.css" rel="stylesheet" />

@*<script src="~/Scripts/JDatatables11012/js/jquery.dataTables.min.js"></script>
<script src="~/Scripts/JDatatables11012/js/dataTables.jqueryui.min.js"></script>
<link href="~/Content/Custom/processes.css" rel="stylesheet" />
<link type="text/css" href="~/Content/themes/smoothness/jquery-ui.css" rel="stylesheet" />
<link type="text/css" href="~/Content/JDatatables11012/css/dataTables.jqueryui.min.css" rel="stylesheet" />
<link type="text/css" href="~/Content/JDatatables11012/css/select.jqueryui.min.css" rel="stylesheet" />*@
<link href="~/Content/datepicker.min.css" rel="stylesheet" />

<div class="col-md-12">
    <div class="titlesbar">
        <div class="col-md-3 caption">
            <i class="fa fa-clock-o font-yellow-crusta" aria-hidden="true"></i>
            <span class="text-uppercase">Appointment Details</span>
        </div>
        <div class=" row-fluid col-md-9">
            <div class="col-md-12">
                <ul class="nav nav-pills">
                    <li>
                        <label class="control-label ftitle">Appointment Type</label>
                    </li>
                    <li>
                        <div class="form-group">
                            @Html.DropDownList("ApptStatus", ApptStatus, "All", new { @class = "invselector" })
                        </div>
                    </li>
                    <li>&nbsp;</li>
                    <li>
                        <div class="col-md-3">
                            <label class="control-label ftitle">Date</label>
                        </div>
                    </li>
                    <li>
                        <div class="form-group">
                            @*@Html.TextBox("frmDate", null, new { placeholder = "From Date", @class = "invselector", width = "10%" })*@
                            @Html.TextBox("frmDate", null, new { placeholder = "From Date", @class = "invselector date", width = "10%" })
                        </div>
                    </li>
                    <li>
                        <div class="form-group">
                            @Html.TextBox("toDate", null, new { placeholder = "To Date", @class = "invselector date", width = "10%" })
                        </div>
                    </li>
                    <li>
                        <div class="form-group">
                            <button class="btn btn-themed" value="Search" id="btnSearch">Search</button>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="clearfix"></div>
<div id="ProcessResults" class="container-fluid">
    @*    <div class="panel panel-default">
        <div class="panel-body">*@
    <div class="row-fluid col-md-12">
        <table id="ColorView" class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th style="width: 125px;">&nbsp;</th>
                    <th>Status</th>
                    <th>SrNo.</th>
                    <th>Email Id</th>
                    <th>Company Name</th>
                    <th>Contact No</th>
                    <th>Office No</th>
                    <th>Appointment At</th>
                    <th>Appointment Date</th>
                    <th>Appointment Time</th>
                    <th>Contact Person</th>
                    <th>No Of Persons</th>
                    <th>Purpose</th>
                    <th>Remarks</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="clearfix"></div>
    <div class="row-fluid col-md-12">
        @Html.Hidden("ActMethod", "AppointmentDets")
    </div>
    @*</div>
    </div>*@

    <div id="procModal" class="popup" style="display: none;">
        <div class="popupcon popupmodal">
            <a class="popupclose" href="javascript:void(0);"><i class="fa fa-close"></i></a>
            <div class="popuphead">Appointment</div>
            <div class="popupcenter">
                <form id="frmProc">
                    <div class="container-fluid">
                        <div class="form-group">
                            @Html.Label("Please select Appointment type", new { @class = "control-label" })
                        </div>
                        @*<div class="form-group">
                            @Html.RadioButton("mApptType", "Pending") @Html.Label("Pending", new { style = "font-size:11px;" })
                        </div>*@
                        <div class="form-group">
                            @Html.RadioButton("mApptType", "Fixed") @Html.Label("Approve", new { style = "font-size:11px;" })
                        </div>
                        <div class="form-group">
                            @Html.RadioButton("mApptType", "Rejected") @Html.Label("Reject", new { style = "font-size:11px;" })
                            @Html.Hidden("mApptCd")
                        </div>
                    </div>
                </form>
            </div>
            <div class="popupfoot">
                <div class="float-right">
                    <a href="javascript:void(0);" id="btnSet" data-response-val="#respAlert" data-request-url="@Url.Action("HandleProcesses", "Process")" class="btn btn-themed">
                        <i class="fa fa-check-circle"></i>&nbsp;Set</a>
                    <a href="javascript:void(0);" id="btnCancel" class="btn btn-default cancel">Cancel</a>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        var curgrid = '#ColorView';
        $(document).ready(function () {
            var sMethod = $("#ActMethod").val(); urlReq = '@Url.Action("serverMethod")';
            var oTable = drawDataTable();
            $('#ApptStatus').on('change', function (e) { var info = [{ "name": "apptStatus", value: $(this).val() }]; drawDataTable(info); });
            $('#btnSearch').on('click', function (e) {
                var info = [{ "name": "aFdate", value: $('#frmDate').val() }, { "name": "aTdate", value: $('#toDate').val() }];
                debugger;
                drawDataTable(info);
            });
            function drawDataTable(additionalData) {
                /*SetLoadingProc();*/
                var oTable = $(curgrid).DataTable({
                    oLanguage: { sProcessing: "<img src='../../Content/images/loader.gif'>" },
                    bProcessing: true, serverSide: true, bSort: false,
                    sAjaxSource: urlReq.replace("serverMethod", sMethod),
                    aLengthMenu: [25, 50, 100], iDisplayLength: 25, bLengthChange: true,
                    bDestroy: true, sEmptyTable: "Loading data from server",
                    searching: false, bAutoWidth: false, paging: true,
                    scrollX: true, scrollY: "395px", stateSave: false,
                    fnServerData: function (sSource, aaData, fnCallback) {
                        if (additionalData != undefined) { $.each(additionalData, function (i, val) { aaData.push(val); }) };
                        $.ajax({ "dataType": 'json', "type": "POST", "url": sSource, "data": aaData, "success": fnCallback }).complete(function () { /*RemoveLoadingProc();*/ });
                    },
                    fnCreatedRow: function (nRow, aData, iDataIndex) {
                        $(nRow).attr('id', aData[2])
                        $('td:eq(0)', nRow).html('<a class="btn btn-primary btn-action btnedit" href="javascript:void(0)" onclick="setAppt(this)" title="Edit"><i class="glyphicon glyphicon-pencil"></i></a>');
                    }
                });
                return oTable;
            }

            $('#btnSet').on('click', function (e) {
                SetLoadingProc();
                $.ajax({
                    url: '@Url.Action("HandleAppt", "Account")', type: 'POST', datatype: 'JSON',
                    data: { "id": $('#mApptCd').val(), "flag": $("input[name='mApptType']:checked").val() },
                    success: function (data) { if (!data.isError) { RemoveLoadingProc(); alert(data.msg); $('#ApptStatus').change(); $('.popupclose').click(); window.load = data.url; } else { alert(data.msg); } },
                    error: function () { RemoveLoadingProc(); alert('Something went wrong..'); }
                }).complete(function () { RemoveLoadingProc(); });
            });

            var ismobile = navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i);
            if (ismobile) {
                $(".date input").addClass('no-grey').prop('readonly', true);
            }
            $('.date').datepicker({ format: "dd-mm-yyyy", todayHighlight: true, autoclose: true, });

        });

            function setAppt(obj) {
                var currow = $(obj).closest('tr'); var rowId = $(currow).attr('id');
                $('#frmProc')[0].reset(); $('#mApptCd').val(rowId); status = $(currow).find('td:nth-child(2)').html();;
                $("input[name='mApptType']").each(function () { var flag = false; if ($(this).val() == status) { flag = true; } $(this).attr('checked', flag); });
                callPopup();
            }

            function callPopup() {
                var popid = $("#procModal");
                $(popid).fadeIn(300, function () { $(document).keyup(function (e) { if (e.keyCode == 27) $('.popupclose').click(); }); });
                function poppos() {
                    var wh = $(window).height(); var ph = $(popid).find('.popupcon').innerHeight(); var popp = wh / 2 - ph / 2; if (popp <= 0) { popp = 0; }
                    $(popid).find(".popupcon").fadeIn().stop(true, false).animate({ top: popp, opacity: 1 }, 400);
                } poppos(); $(window).resize(poppos);
            }
    </script>
    <script src="~/Scripts/bootstrap-datepicker.min.js"></script>
    <script src="~/Scripts/toastr.min.js"></script>
</div>
